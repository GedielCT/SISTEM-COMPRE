<script>
// Corrige links dinamicamente para funcionar em GitHub Pages e Live Server
(function() {
    function getBase() {
        let base = window.location.pathname;
        if (base.match(/\.[a-zA-Z0-9]+$/)) base = base.substring(0, base.lastIndexOf("/")) + "/";
        const pathParts = base.split("/").filter(Boolean);
        let root = "/";
        if (pathParts.length > 0) root = "/" + pathParts[0] + "/";
        if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") root = "/";
        return root;
    }
    const root = getBase();
    document.querySelectorAll('a[href], link[href], img[src], script[src]').forEach(el => {
        let attr = el.hasAttribute('href') ? 'href' : 'src';
        let val = el.getAttribute(attr);
        if (val && !val.match(/^(https?:|#|mailto:|javascript:)/) && !val.startsWith(root)) {
            if (val.startsWith('/')) val = val.substring(1);
            el.setAttribute(attr, root + val);
        }
    });
})();

document.addEventListener('DOMContentLoaded', function() {
    fetch('../../PHP/buscar_produtos.php')
        .then(response => response.json())
        .then(produtos => {
            const tbody = document.querySelector('.relatorio tbody');
            tbody.innerHTML = '';
            produtos.forEach(produto => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${produto.codigo}</td>
                    <td>${produto.nome_produto}</td>
                    <td>${produto.marca_produto}</td>
                    <td>${produto.categoria}</td>
                    <td>${produto.quantidade}</td>
                    <td>R$ ${parseFloat(produto.valor_unitario).toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                    <td>
                        <button class="editar"><img src="../../img/editar.png" alt="Editar"></button>
                        <button class="excluir"><img src="../../img/excluir.png" alt="Excluir"></button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        });
});
</script>

<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Compre</title>
    <link rel="stylesheet" href="../../css/reset-min.css">
    <link rel="stylesheet" href="../../css/padrao.css">
    <link rel="stylesheet" href="../../css/tela.css">
    <link rel="stylesheet" href="../../css/consultas/consultas.css">
</head>
<body>
    <barra-navegacao></barra-navegacao>
    <div class="centralizar">
        <div class="tela">
            <header>
                <h1><img src="../../img/caixa.png" alt="Consulta de Clientes"> Consulta de Produto</h1>
                <a href="../../home.html" class="voltar">X</a>
            </header>
            <section>
                <div class="filtros">
                    <label for="buscar">Buscar:</label>
                    <input type="text" id="buscar" name="buscar">

                    <label for="filtrar-por">Filtrar por:</label>
                    <select id="filtrar-por" name="filtrar-por">
                        <option value="codigo">Código</option>
                        <option value="nome">Nome</option>
                        <option value="marca">Marca</option>
                        <option value="categoria">Categoria</option>
                        <option value="quantidade">Quantidade</option>
                        <option value="valor">Valor</option>
                    </select>
                
                    <label for="ordemar-por">Ordenar por:</label>
                    <select id="ordenar-por" name="ordenar-por">
                        <option value="codigo">Código</option>
                        <option value="nome">Nome</option>
                        <option value="marca">Marca</option>
                        <option value="categoria">Categoria</option>
                        <option value="quantidade">Quantidade</option>
                        <option value="valor">Valor</option>
                    </select>

                    <img src="../../img/lupa.png" alt="Lupa">
                    <button id="consultar">Consultar</button>
                </div>
                <div class="relatorio">
                    <table>
                        <colgroup>
                            <col style="width: 80px;">
                            <col style="width: 300px;">
                            <col style="width: 160px;">
                            <col style="width: 140px;">
                            <col style="width: 80px;">
                            <col style="width: 90px;">
                            <col style="width: 100px;">
                        </colgroup>
                        <thead>
                            <tr>
                                <th>Código</th>
                                <th>Nome Produto</th>
                                <th>Marca</th>
                                <th>Categoria</th>
                                <th>Quantidade</th>
                                <th>Valor</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </section>
        </div>
    </div>
</body>
<script src="../../componentes/barraNavegacao.js"></script>
</html>